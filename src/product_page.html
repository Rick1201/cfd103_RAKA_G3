<!DOCTYPE html>
<html lang="zh-hant">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<script src="https://kit.fontawesome.com/2c95395281.js" crossorigin="anonymous"></script>
	<script src='https://cdnjs.cloudflare.com/ajax/libs/axios/0.8.1/axios.js' integrity='sha512-yQvhnV+bdDcAhyxTlmVUyNikQCtnIkfC9r7GesIjLg6IrJx2M92DSv58LpyobngV7WUeM1c3mpgP0971pIY98A==' crossorigin='anonymous'></script>
	<!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.carousel.min.css"></link>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.theme.default.min.css"></link> -->
    <!-- <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/owl.carousel.min.js"></script> -->
	<!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.carousel.min.css"></link>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.theme.default.min.css"></link> -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.carousel.min.css" integrity="sha512-tS3S5qG0BlhnQROyJXvNjeEM4UpMXHrQfTGmbQ1gKmelCxlSEBUaxhRBj/EFTzpbP4RVSrpEikbmdJobCvhE3g==" crossorigin="anonymous" referrerpolicy="no-referrer" />
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.theme.default.min.css" integrity="sha512-sMXtMNL1zRzolHYKEujM2AqCLUR9F2C4/05cdbxjjLSRvMQIciEPCQZo++nk7go3BtSuK9kfa/s+a4f4i5pLkw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
	<link rel="stylesheet" href="./css/style.css">
	<script src="https://code.jquery.com/jquery-3.5.1.js"></script>
	<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/owl.carousel.min.js"></script> -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/owl.carousel.min.js" integrity="sha512-bPs7Ae6pVvhOSiIcyUClR7/q2OAsRiovw4vAkX+zJbw3ShAeeqezq50RIIcIURq7Oa20rW2n2q+fyXBNcU9lrw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
	<script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
	<title>RAKA｜商品詳情</title>
</head>
<body>
	<!-- 商品圖與價格 -->
	@@include('./layout/header.html')
	<div id="app">
		<section class="product">
			<div class="container">
				<div class="product-pic">
					<div class="switch-pics">
						<div class="switch-pic">
							<img class="clicked" :src="currentProudcut.Product_PIC01" alt="">
						</div>
						<div class="switch-pic">
							<img :src="currentProudcut.Product_PIC02" alt="">
						</div>
						<div class="switch-pic">
							<img :src="currentProudcut.Product_PIC03" alt="">
						</div>
						<div class="switch-pic">
							<img :src="currentProudcut.Product_PIC04" alt="">
						</div>
					</div>
					<div class="main-pic">
						<img :src="currentProudcut.Product_PIC01" alt="">
					</div>
				</div>
				<div class="product-title">
					<h2>{{currentProudcut.Product_Name}}</h2>
					<p>NT$ <span>{{currentProudcut.Product_Price}}</span></p>
					<button @click="addLocal">加入購物車</button>
				</div>
			</div>
		</section>
	
		<!-- 商品詳細內容 -->
		<section id="product-detail">
			<ul class="section-select">
				<li class="product-info detail-tab active-tab" @click="content='info'">商品資訊</ㄠ>
				<li class="product-specification detail-tab" @click="content='specification'">規格</li>
				<li class="product-comment detail-tab" @click="content='comment'">評論</li>
			</ul>
			<div class="container">
				<keep-alive>
					<component :is="content" :currentinfo="currentProudcut"></component>
				</keep-alive>
			</div>
		</section>
	
	
		<!-- 相關商品 -->
		<section class="relative-product">
			<div class="container">
				<h3>相關商品</h3>
				<div class="owl-carousel owl-theme">
					<div class="item" v-for="(item, index) in relative"
					:key="item.Product_ID"
					>
						<a :href="`product_page.html?id=${item.Product_ID}`">
							<div class="product-card">
								<div class="product-pic">
									<img :src="item.Product_PIC01" alt="">
								</div>
								<div class="product-txt">
									<h4>{{item.Product_Name}}</h4>
									<P>NT${{item.Product_Price}}</P>
								</div>
							</div>
						</a>
					</div>
				</div>
			</div>
		</section>
	</div>


	<script>
		function showLarge(e){
			let small = e.target;
			document.querySelector(".main-pic img").src = small.src;
			let smalls = document.querySelectorAll(".switch-pic img");
			for(let i =0; i<smalls.length;i++){
				smalls[i].classList.remove("clicked");
			}
			small.classList.add("clicked");
		}

		function tabActive(e){
			let tab = e.target;
			let tabs = document.querySelectorAll(".detail-tab");
			for(let i = 0; i < tabs.length; i++){
				tabs[i].classList.remove("active-tab");
			}
			tab.classList.add("active-tab");
		}

		function init(){
			let imgs = document.querySelectorAll(".switch-pic img");
			for(let i=0; i<imgs.length; i++){
				imgs[i].onclick = showLarge;
			}

			let tabs = document.querySelectorAll(".detail-tab");
			for(let i = 0; i < tabs.length; i++){
				tabs[i].onclick = tabActive;
			}

			$(".owl-carousel").owlCarousel({
				loop: true, 
				margin: 60, 
				nav: true, 
				dots: false,
				responsive: {
					0: {
					items: 1
					},
					376: {
					items: 3
					},
				}
			});
		}
		window.addEventListener("load",init,false);
	</script>

	<script>
		Vue.component("info",{
			props:['currentinfo'],
			template:`
				<div class="info-content">
					<p class="info-txt">
						{{currentinfo.Product_Info}}
					</p>
					<p class="info-txt">
						{{currentinfo.Product_Info}}
					</p>
				</div>
			`,
		});
		Vue.component("specification",{
			props:['currentinfo'],
			template:`
				<div class="specification-pic">
					<img :src="currentinfo.Product_Spec">
				</div>
			`,

			data(){
				return{
					// imageURL:"./images/product_page_specification.jpg",
				}
			},
			mounted() {
				let id = location.search.slice(1).split('=')[1]
				console.log(id)
			},
		});

		Vue.component("comment-item",{
			template:`
				<div>
					<div class="comment-item">
						<div class="mem-pic">
							<img src="https://picsum.photos/id/217/600/600" alt="">
						</div>
						<div class="comment-content">
							<div class="comment-score">
								<i class="fas fa-star"></i>
								<i class="fas fa-star"></i>
								<i class="fas fa-star"></i>
								<i class="fas fa-star"></i>
							</div>
							<div class="comment-txt">
								<span class="mem-Id">Alice0531</span>
								<span> : </span>
								<span class="mem-comment">超美的手錶!!超美的手錶!!超美的手錶!!超美的手錶!!</span>
							</div>
						</div>
						<div class="report-btn">
							<i class="fas fa-exclamation-triangle"></i>	
						</div>
					</div>
					<hr>
				</div>
			`,
		});

		Vue.component("comment",{
			template:`
				<div class="comment-list">
					<comment-item></comment-item>
					<comment-item></comment-item>
					<comment-item></comment-item>
					<comment-item></comment-item>
					<comment-item></comment-item>
				</div>
			`,
		});


		
		new Vue({
            el: '#app',
            data(){
				return {
					itemCount:'0',
					content: 'info',
					tabs:["商品資訊","規格","評論"],
					// products:{
					// 		id:'20',						
					// 		prodName:'海洋飛行PCB-01',
					// 		prodPrice:'6000',
					// 		prodImg:'./images/product_page_02.png',
					// 		count:1,
					// 	},
					cart:null,
					// switchpic1:'./images/product_page_01.png',
					// switchpic2:'./images/product_page_02.png',
					// switchpic3:'./images/product_page_03.png',
					// switchpic4:'./images/product_page_04.png',
					// pagepic:'./images/product_page_01.png',
					// suggestpic:'./images/product_page_01.png',
					// title:[{
					// 	name:'RAKA-1001',
					// 	price:'NT$1200'
					// }],
					currentProudcut:{},
					allProducts:[],
				}
            },
			methods: {
				updateCart(){
                    let storageArray = JSON.parse(localStorage.getItem('addList'));
                    this.cart = storageArray||[];
                    this.itemCount = this.cart.length;
                },
				addLocal(){
					if(this.cart == []){
						// alert()
						// this.cart = this.products;
						this.cart.push(this.products);
						// this.cart.push(123);
					}else{                      
						// for (let i = 0; i < this.cart.length; i++){
						// 	console.log(this.cart)
						// 	if(this.products[0].id === this.cart[i].id){
						// 		console.log('aaa',this.cart[i].id)
						// 	 	this.cart[i].count += 1;
							
						// 	}else if(this.products[0].id !== this.cart[i].id){
						// 		console.log(this.products[0].id)
						// 		this.cart.push(this.products[0]);
						// 	}
						// }
						let index = this.cart.findIndex(item => item.Product_ID == this.currentProudcut.Product_ID);
						if (index > -1) this.cart[index].count += 1;
						else this.cart.push(this.currentProudcut);
				
					}
					localStorage.setItem("addList", JSON.stringify(this.cart));
					vmHeader.updateCart();
				},
				fetchAllData(srcId){
                    axios.post("php/productList_page.php",{action:'fetchall'}).then(res=>
                    {
						this.allProducts=res.data;
						for(let i =0;i<res.data.length;i++){
							if(res.data[i].Product_ID == srcId){
								this.currentProudcut = res.data[i];
								this.currentProudcut = Object.assign({}, this.currentProudcut, {count: 1});
							}
						}
                    });
                },
			},
			computed:{
				relative(){
					return this.allProducts.filter(item=>{
						return item.Product_CType == this.currentProudcut.Product_CType
					});
				},
			},
			mounted() {
				this.updateCart();
				let srcId=location.search.slice(1).split("=")[1];
				this.fetchAllData(srcId);
			},
			// addLocal(){
			// 	let prodCart = localStorage.setItem("addList", JSON.stringify(this.products));
			// 	console.log(prodCart);
			// 	this.ooxx =  prodCart;
			// },
        });
	</script>


 @@include('./layout/footer.html')
</body>
</html>