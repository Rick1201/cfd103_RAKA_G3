<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>RAKA｜會員中心</title>
		<link rel="stylesheet" href="./css/style.css"/>
		<script src='https://cdnjs.cloudflare.com/ajax/libs/axios/0.8.1/axios.js' integrity='sha512-yQvhnV+bdDcAhyxTlmVUyNikQCtnIkfC9r7GesIjLg6IrJx2M92DSv58LpyobngV7WUeM1c3mpgP0971pIY98A==' crossorigin='anonymous'></script>
		<script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
	</head>
	<body>
		@@include('./layout/header.html')
		<div class="member-section" id="app">
			<section class="member-select">
				<div class="member-side-bar">
					<header class="member-header">
						<div class="member-img" style="width: 50px;">
							<img id="userImage" src="https://fakeimg.pl/50x50/#aaa" style="width: 100%;"/>
						</div>
						<div class="member-name">
							<h1>Hello ,<span id="userName"></span>!</h1>
							<button class="member-edit-btn" id="editBox">編輯個人檔案</button>
						</div>
					</header>
					
					<div class="data-box" >
						<table>
							<tr>
								<td>累積消費</td>
							</tr>
							<tr>
								<td>${{memberTotal}}元</td>
							</tr>
						</table>
						<div class="lightbox" id="lightbox">
							<div class="container">
								<span id="closeBox">X</span>
								<div class="lightbox-header">
									<div class="lightbox-member-img">
										<img src="../dist/images/member01.jpg" id="lightboxUserImage">
									</div>
									<div class="lightbox-member-name">
										<h1 id="lightboxUserName">Emma Li</h1>
										<label for="files" class="member-edit-btn">選擇大頭貼</label>
										<input type="file" id="files" ref="spec" accept=".jpg,.png,.svg">
									</div>
								</div>
								<div class="lightbox-txt">
									<h2>我的地址</h2>
									<input class="txt-box" type="text" value="" id="address">
								</div>
								<div class="lightbox-txt">
									<h2>Email</h2>
									<input class="txt-box" type="text" value="" id="email">
								</div>
								<div class="lightbox-txt">
									<h2>電話</h2>
									<input class="txt-box" type="text" value="" id="phone">
								</div>
								<div class="lightbox-txt">
									<h2>我的信用卡</h2>
									<input class="txt-box" type="text" value="" id="card">
								</div>
								<div class="lightbox-btn-check">
									<button>取消</button>
									<button>儲存</button>
								</div>
							</div>
						</div>
					</div>
					<div class="member-card">
						<img src="./images/memberCard.png" alt="">
					</div>
					<div class="member-side-bar-btn">
						<a href="member_comm_order.html" class="sub-a">商品訂單</a>
						<a href="member_comm_order_customize.html" class="sub-a">客製化訂單</a>
						<a href="member_comm_customize.html" class="sub-a">商品收藏</a>
					</div>
				</div>
				
			</section>
			<div class="member-content-membercomm-order-customize">
				<section class="member_order">
					<div class="member_area">
			
				
					<!-- 頁籤 -->
					<!-- 會員資料 -->
					<div class="member_container">
						<div class="select-title">
							<h2>客製化訂單</h2>
						</div>              
						<div class="selectbar">
								<div class="selectbarbtn" @click="visibility='all'">所有訂單</div>
								<div class="selectbarbtn" @click="visibility='active'">已付款</div>
								<div  class="selectbarbtn" @click="visibility='completed'">已出貨</div>
						</div>
						<div  v-for="(member, index) in filters" class="member" :key="index">
							<div class="member_text">
									<div>
										<p>訂單編號</p>
										<p>{{member.Order_ID}}</p>
									</div>
									<div>
										<p>訂單狀態</p>
										<p>{{member.Order_Status == 0 ? '未出貨' : '已出貨'}}</p>
									</div>
									<div>
										<p>下單時間</p>
										<p>{{member.Order_Date}}</p>
									</div>
									<div>
										<p>總計</p>
										<p>{{member.Order_Total}}</p>
									</div>
			
							</div>
							<div class="order_button">
								<button @click="clickItem(index + 1)">查看訂單</button>
								<!-- <button @click="clickItem(index + 1)">查看訂單 {{ index + 1 }}</button> -->
							</div>
							<div class="member_status_bg" v-show="showItem(index + 1)">
								<div class="order_details_list">
									<div class="formitem">
										<h2>客製品項明細</h2>
										<div class="row">
											<h3>外觀</h3>
											<div class="info-2">
												<div class="watchinfo-title">錶框</div>
												<div class="watchinfo">{{currentobj.WOuter_Name}}</div>
											</div>
											<div class="info-2">
												<div class="watchinfo-title">錶面</div>
												<div class="watchinfo">{{currentobj.WFace_Name}}</div>
											</div>
											<div class="info-2">
												<div class="watchinfo-title">錶帶</div>
												<div class="watchinfo">{{currentobj.WBand_Name}}</div>
											</div>
											<div class="info-2">
												<div class="watchinfo-title">指針</div>
												<div class="watchinfo">{{currentobj.WPointer_Name}}</div>
											</div>
											<div class="info-2">
												<h3>功能錶盤</h3>
												<div class="info-item">
													<div class="info-pic">
														<img src="./images/finishfunpic.png">
													</div>
													<div class="info-txt">
														<ol>
															<li>1、{{currentobj.funcName1}}</li>
															<li>2、{{currentobj.funcName2}}</li>
															<li>3、{{currentobj.funcName3}}</li>
														</ol>
													</div>
												</div>
											</div>
											<div class="info-2">
												<h3>潛水規格需求</h3>
												<div class="funitem">
													<p>{{currentobj.Div_Name}}</p>
												</div>
											</div>
											<div class="info-2">
												<h3>刻字服務</h3>
												<div class="worditem">
													<ol>
														<li>1、字體:{{currentobj.WFont_Name}}</li>
														<li>2、字體大小:{{currentobj.WFontSize_ID}}</li>
														<li>3、刻字內容:{{currentobj.WFontText}}</li>
													</ol>
												</div>
											</div>
											<div class="info-2">
												<h3>包裝</h3>
												<div class="color-item">
													<div class="box-color">
														<div class="txt">
															<p>外盒顏色</p>
														</div>
														<div class="pic">
															<img :src="currentobj.PBox_PIC">
														</div>
													</div>
													<div class="rib-color">
														<div class="txt">
															<p>緞帶顏色</p>
														</div>
														<div class="pic">
															<img :src="currentobj.PBand_PIC">
														</div>
													</div>
												</div>
											</div>
										</div>
										<div class="total-price">
											<p>商品金額 $7000元</p>
										</div>
										<div class="button">
											<button @click="clickItem(index + 1)">返回訂單</button>
										</div>
									</div>
								</div>
							</div>
							
							<div class="member_comment_bg" v-show="member.comment=='true'">
								<div class="member_comment">
			
									<div>
										<p>評分</p>
									</div>
									<div class="comment_text">
										<div>評論</div>
										<input type="text">
									</div>
									<button @click="member.comment='false'">確認</button>
								</div>
							</div>
						</div>
			
					</div>
					
					</div>
			
			
			
				</section>
			</div>
			@@include('./layout/footer.html')
			<script>
				function showBox(){
					// document.getElementById('lightbox').style.display = "block";
					let lightBox = document.getElementById('lightbox').style.display = "block";
					let txtBox = document.querySelectorAll('.txt-box');
					let address = document.getElementById('address').value;
				}
				function closeBox(){
					document.getElementById('lightbox').style.display = "none";
				}
				function fetchData(memID){//
					axios.post('php/member_comm.php',{
					action:'fetchSingle',
					id:memID.Member_ID,
					}).then(res=>{
						console.log(res);
						document.querySelector("#address").value = res.data.Member_Address;
						document.querySelector("#email").value = res.data.Member_Mail;
						document.querySelector("#phone").value = res.data.Member_Phone;
						document.querySelector("#card").value = res.data.Member_Card;
						document.getElementById('userName').innerText = res.data.Member_Name;
						document.getElementById('lightboxUserName').innerText = res.data.Member_Name;
						document.getElementById('userImage').src = res.data.Member_Profile;
						document.getElementById('lightboxUserImage').src = res.data.Member_Profile;

					})
				};
				function memCenter(){
					document.querySelector(".member-select").classList.toggle("active");
				}
				function init(){
					document.getElementById("editBox").onclick=showBox;
					document.getElementById("closeBox").onclick=closeBox;
					let memID = JSON.parse(localStorage.getItem('memberID'));
					fetchData(memID);
					document.querySelector(".member-select").onclick = memCenter;
				}
				window.addEventListener("load", init, false);
			</script>
		</div>
		<script>
			new Vue({
				el:'#app',
				data:{
				currentobj:'',
    			cus:[],
				memberTotal:'0',
				id:[],
				spec:"",
				formData : new FormData(),
				dir:"",
				memAdd:"",
				memEmail:"",
				memTel:"",
				memCard:"",
				item:[],
				activedItemList: [0],	
				showComment:false,
                showOrder:false,                
                members:[
                    // {
                    // number:"RA000001",
                    // time:"2021/01/02",
                    // state:"未出貨",
                    // price:"$31440",
                    // },
                    // {
                    // number:"RA000001",
                    // time:"2021/01/02",
                    // state:"已出貨",
                    // price:"$14540",

                ],

                visibility: "all",
					memberTotal:'0',
					id:[],
				},
				computed: {
					filters: function () {
						if (this.visibility == "all") {
							return this.members;
						} else if (this.visibility == "active") {
							let newMembers = [];
							this.members.forEach(function (item) {
								if (item.Order_Status==="0") {
									newMembers.push(item);
								}
							});
							return newMembers;
						} else if (this.visibility == "completed") {
							let newMembers = [];
							this.members.forEach(function (item) {
								if (item.Order_Status==="1") {
									newMembers.push(item);
								}
							});
							return newMembers;
						}
					
					},
                    // addStatus(){
                    //     this.members.forEach(member => {
                    //         add status= false
                            
                    //     });
                    // }
                    
		},
				methods: {
					fetchData(id){
						axios.post('php/member_comm.php',{
						action:'fetchSingle',
						id:this.id.Member_ID,
						}).then(res=>{
						this.item = res.data;
						this.memAdd = res.data.Member_Address;
						this.memEmail = res.data.Member_Mail;
						this.memTel = res.data.Member_Phone;
						this.memCard = res.data.Member_Card;
					})
					},
					fetchCus(id){
					axios.post("./php/member_comm_order_customize.php",{
					action:'fetchall',
					id:id
					}).then(res=>
					{
					console.log(res) 
					this.cus=res.data
					}
					)
					},
					editImg(){
						this.spec = this.$refs.spec.files[0]
						this.formData.append("file",this.spec)
						axios.post("./php/upload.php",this.formData,{
							"Content-Type":"multipart/form-data"
						}
						).then(res=>
						{
							this.dir = res.data.image;
							this.memSubmit();
						}
						)
					},
					getMemberId(){
						let memberId = JSON.parse(localStorage.getItem('memberID'));
						this.id = memberId;
					},
					fetchAllTotal(){
						axios.post("./php/memberSum.php",{
						action:'fetchSingle',//資料參數丟過去ajaxLogin.php
						memId:this.id.Member_ID,
						}
						).then(res=>
						{
							console.log(res.data);
							this.memberTotal = res.data.Order_Total;
						}
						)
					},
					cancel(){
						document.getElementById('lightbox').style.display = "none";
					},
					XBox(){
						document.getElementById('lightbox').style.display = "none";
						location.href = "./member_comm_customize.html";
					},
					memSubmit(){
						if(this.dir){
							axios.post("./php/memberSubmit.php",{
							action:'update',
							id:this.id.Member_ID,
							memImg:this.dir,
							memAdd:this.memAdd,
							memEmail:this.memEmail,
							memTel:this.memTel,
							memCard:this.memCard,
							}
							).then(res=>
							{
								console.log(res.$data);
								this.XBox();
							}
							)
						}else{
							axios.post("./php/memberSubmit.php",{
							action:'update1',
							id:this.id.Member_ID,
							memAdd:this.memAdd,
							memEmail:this.memEmail,
							memTel:this.memTel,
							memCard:this.memCard,
							}
							).then(res=>
							{
								console.log(res.$data);
								this.XBox();
							}
							)
						}
					},
					fetchAllDate(id){
						axios.post("./php/member_order_customize.php",{
						action:'fetchall',
						id:id
						}).then(res=>
						{
						this.members=res.data
						}
						)
					},
					clickItem(itemLabel) {
					this.currentobj=this.cus[itemLabel-1];
					const itemExist = this.activedItemList.find((item) => item === itemLabel);
					if (itemExist) {
					const itemIndex = this.activedItemList.findIndex(
					(item) => item === itemLabel
					);
					this.activedItemList.splice(itemIndex, 1);
					} else {
					this.activedItemList.push(itemLabel);
					}
					},
					showItem(itemLabel) {
					return this.activedItemList.find((item) => item === itemLabel);
					},
					openShowOrder(index){
                	this.showOrder=!this.showOrder;
            		},
            		openShowComment(index){
                	this.showComment=!this.showComment;
            		},
            		

					getMemberId(){
						let memberId = JSON.parse(localStorage.getItem('memberID'));
						this.id = memberId;
					},
					fetchAllTotal(){
						axios.post("./php/memberSum.php",{
						action:'fetchSingle',//資料參數丟過去ajaxLogin.php
						memId:this.id.Member_ID,
						}
						).then(res=>
						{
							console.log(res.data);
							this.memberTotal = res.data.Order_Total;
						}
						)
					},
					getId(id) {
					console.log(id)
					// this.id = OrderId;
					this.fetchCus(id);
					},
				},
				
				mounted() {
					let id = JSON.parse(localStorage.getItem("memberID"));
                	this.fetchAllDate(id.Member_ID);
                	this.fetchCus(id.Member_ID);
					this.getMemberId();
					this.fetchAllTotal();
					this.fetchData();
				},
			});
		</script>
	</body>
</html>
