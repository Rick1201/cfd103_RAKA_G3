<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>後台管理頁面</title>
		<link
			href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css"
			rel="stylesheet"
			integrity="sha384-F3w7mX95PdgyTmZZMECAngseQB83DfGTowi0iMjiWaeVhAn4FJkqJByhZMI3AhiU"
			crossorigin="anonymous"
		/>
		<link rel="stylesheet" href="./css/back.css" />
		<script
			src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.1/dist/umd/popper.min.js"
			integrity="sha384-W8fXfP3gkOKtndU4JGtKDvXbO53Wy8SZCQHczT5FMiiqmQfUpWbYdTil/SxwZgAN"
			crossorigin="anonymous"
		></script>
		<script
			src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.min.js"
			integrity="sha384-skAcpIdS7UcVUC05LJ9Dxay8AXcDYfBJqt1CJ85S/CFujBsIzCIv+l9liuYLaMQ/"
			crossorigin="anonymous"
		></script>
	</head>
	<body>
		<div id="app">
			<header class="main-header">
				<div class="container">
					<div class="logo">
						<img src="./images/logo.png" alt="" />
					</div>
				</div>
			</header>
			<section class="backStage">
				<div class="accordion accordion-flush" id="accordionFlushExample">
					<div class="accordion-item">
						<h2 class="accordion-header" id="flush-headingOne">
							<button
								class="accordion-button collapsed"
								type="button"
								data-bs-toggle="collapse"
								data-bs-target="#flush-collapseOne"
								aria-expanded="false"
								aria-controls="flush-collapseOne"
							>
								訂單列表管理
							</button>
						</h2>
						<div
							id="flush-collapseOne"
							class="accordion-collapse collapse"
							aria-labelledby="flush-headingOne"
							data-bs-parent="#accordionFlushExample"
						>
							<div class="accordion-body d-grid gap-2">
								<button class="btn btn-primary"  onclick="javascript:location.href='orderManage.html'">商品訂單</button>
								<button class="btn btn-primary" onclick="javascript:location.href='cuzorderManage.html'">客製化訂單</button>
							</div>
						</div>
					</div>
					<div class="accordion-item">
						<h2 class="accordion-header" id="flush-headingTwo">
							<button
								class="accordion-button collapsed"
								type="button"
								data-bs-toggle="collapse"
								data-bs-target="#flush-collapseTwo"
								aria-expanded="false"
								aria-controls="flush-collapseTwo"
							>
								商品項目管理
							</button>
						</h2>
						<div
							id="flush-collapseTwo"
							class="accordion-collapse collapse"
							aria-labelledby="flush-headingTwo"
							data-bs-parent="#accordionFlushExample"
						>
							<div class="accordion-body d-grid gap-2">
								<button class="btn btn-primary" onclick="javascript:location.href='productManage.html'">商品管理</button>
							</div>
						</div>
					</div>
					<div class="accordion-item">
						<h2 class="accordion-header" id="flush-headingThree">
							<button
								class="accordion-button collapsed"
								type="button"
								data-bs-toggle="collapse"
								data-bs-target="#flush-collapseThree"
								aria-expanded="false"
								aria-controls="flush-collapseThree"
							>
								客製化元件管理
							</button>
						</h2>
						<div
							id="flush-collapseThree"
							class="accordion-collapse collapse"
							aria-labelledby="flush-headingThree"
							data-bs-parent="#accordionFlushExample"
						>
							<div class="accordion-body d-grid gap-2">
								<button class="btn btn-primary" onclick="javascript:location.href='wouterManage.html'">外框管理</button>
								<button class="btn btn-primary" onclick="javascript:location.href='wfaceManage.html'">錶面管理</button>
								<button class="btn btn-primary" onclick="javascript:location.href='wpointerManage.html'">指針管理</button>
								<button class="btn btn-primary" onclick="javascript:location.href='wbandManage.html'">錶帶管理</button>
								<button class="btn btn-primary" onclick="javascript:location.href='wfucManage.html'">功能管理</button>
								<button class="btn btn-primary" onclick="javascript:location.href='packageManage.html'">包裝管理</button>
								<button class="btn btn-primary" onclick="javascript:location.href='bandManage.html'">緞帶管理</button>
							</div>
						</div>
					</div>
					<div class="accordion-item">
						<h2 class="accordion-header" id="flush-headingFour">
							<button
								class="accordion-button collapsed"
								type="button"
								data-bs-toggle="collapse"
								data-bs-target="#flush-collapseFour"
								aria-expanded="false"
								aria-controls="flush-collapseFour"
							>
								會員管理
							</button>
						</h2>
						<div
							id="flush-collapseFour"
							class="accordion-collapse collapse"
							aria-labelledby="flush-headingFour"
							data-bs-parent="#accordionFlushExample"
						>
							<div class="accordion-body d-grid gap-2">
								<button class="btn btn-primary" onclick="javascript:location.href='memberManage.html'">會員管理</button>
								<button class="btn btn-primary" onclick="javascript:location.href='commentManage.html'">評論管理</button>
							</div>
						</div>
					</div>
					<div class="accordion-item">
						<h2 class="accordion-header" id="flush-headingFive">
							<button
								class="accordion-button collapsed"
								type="button"
								data-bs-toggle="collapse"
								data-bs-target="#flush-collapseFive"
								aria-expanded="false"
								aria-controls="flush-collapseFive"
							>
								管理員管理
							</button>
						</h2>
						<div
							id="flush-collapseFive"
							class="accordion-collapse collapse"
							aria-labelledby="flush-headingFive"
							data-bs-parent="#accordionFlushExample"
						>
							<div class="accordion-body d-grid gap-2">
								<button class="btn btn-primary" onclick="javascript:location.href='managerManage.html'">管理員管理</button>
							</div>
						</div>
					</div>
				</div>
				<div class="component_area">
					<div class="title_area">
						<h3>會員管理</h3>
					</div>
					<div class="container">

							<div class="tab_dist">
								<div class="btn-group" role="group" aria-label="Basic example">
									<button
										type="button"
										class="btn btn-primary"
										@click="visibility='all'"
									>
										所有
									</button>
									<button
										type="button"
										class="btn btn-primary"
										@click="visibility='active'"
									>
										未上架
									</button>
									<button
										type="button"
										class="btn btn-primary"
										@click="visibility='completed'"
									>
										上架中
									</button>
								</div>
							</div>
							<div class="table_dist">
								<div class="table-responsive">
									<table class="table">
										<thead>
											<tr>
												<th v-for="head in table_head">{{ head }}</th>
											</tr>
										</thead>
										<tbody>
											<tr v-for="(item,index) of filters " :key="item.Member_ID">
												<td>{{item.Member_ID}}</td>
												<td>{{item.Member_Mail}}</td>
                                                <td>{{item.Member_PSWD}}</td>
                                                <td>{{item.Member_Name}}</td>
                                                <td>{{item.Member_Phone}}</td>
                                                <td>{{item.Member_Address}}</td>
                                                <td>會員累積消費金額:{{item.Consum_Total}}</td>
                                                <td>{{item.Member_Card}}</td>
												<td><img width="200" height="200" :src="item.Member_Profile" alt=""></td>
												<td>{{item.Member_Status==0 ? "停權":"正常"}}</td>
												<td>
													<button
														class="btn btn-outline-primary"
														data-bs-toggle="modal"
														:data-bs-target="`#product_edit_${index}`"
													>
														Edit
													</button>
												</td>
												<td>
													<button class="btn" @click="deleteData(item.Member_ID)">
														&times;
													</button>
												</td>
											</tr>
										</tbody>
									</table>

									<!-- product edit modal -->
									<div
										class="modal fade"
										:id="`product_edit_${index}`"
										tabindex="-1"
										aria-labelledby="exampleModalLabel"
										aria-hidden="true"
										v-for="(item,index) of filters"
									>
										<div class="modal-dialog">
											<div class="modal-content">
												<div class="modal-header">
													<h5 class="modal-title" id="exampleModalLabel">
														編輯會員資料
													</h5>
													<button
														type="button"
														class="btn-close"
														data-bs-dismiss="modal"
														aria-label="Close"
													></button>
												</div>
													<div class="modal-body">
														<div class="mb-3">
															<label class="form-label"
																>會員編號:{{item.Member_ID }}</label
															>
														</div>

                                                        <div class="mb-3">
															<label
																:for="`product_edit_${index}_acc`"
																class="form-label"
																>會員帳號</label
															>
															<input
																type="text"
																class="form-control"
																:id="`product_edit_${index}_acc`"
																name="name"
																v-model="item.Member_Mail"
															/>
														</div>

                                                        <div class="mb-3">
															<label
																:for="`product_edit_${index}_pswd`"
																class="form-label"
																>會員帳號</label
															>
															<input
																type="text"
																class="form-control"
																:id="`product_edit_${index}_pswd`"
																name="name"
																v-model="item.Member_PSWD"
															/>
														</div>

                                                        <div class="mb-3">
															<label
																:for="`product_edit_${index}_name`"
																class="form-label"
																>會員名稱</label
															>
															<input
																type="text"
																class="form-control"
																:id="`product_edit_${index}_name`"
																name="name"
																v-model="item.Member_Name"
															/>
														</div>

                                                        <div class="mb-3">
															<label
																:for="`product_edit_${index}_phone`"
																class="form-label"
																>會員電話</label
															>
															<input
																type="text"
																class="form-control"
																:id="`product_edit_${index}_phone`"
																name="name"
																v-model="item.Member_Phone"
															/>
														</div>

                                                        <div class="mb-3">
															<label
																:for="`product_edit_${index}_adds`"
																class="form-label"
																>會員地址</label
															>
															<input
																type="text"
																class="form-control"
																:id="`product_edit_${index}_adds`"
																name="name"
																v-model="item.Member_Address"
															/>
														</div>

                                                        <div class="mb-3">
															<label
																:for="`product_edit_${index}_card`"
																class="form-label"
																>會員信用卡</label
															>
															<input
																type="text"
																class="form-control"
																:id="`product_edit_${index}_card`"
																name="name"
																v-model="item.Member_Card"
															/>
														</div>



														<div class="form-check mb-3">	
															<label
																class="form-label"
																:for="`product_edit_${index}_status`"
															>
																編輯狀態</label
															>
															<select
																class="form-control"
																:id="`product_edit_${index}_status`"
																name="status"
																v-model="item.Member_Status"
															>
															<option value="0">停權</option>
															<option value="1">正常</option>
															</select>
														
														</div>

														
													</div>
													<div class="modal-footer">
														<button
															type="button"
															class="btn btn-secondary"
															data-bs-dismiss="modal"
															@click="editData(item)"
														>
															修改完成
														</button>
													</div>
												</form>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</section>
			<footer></footer>
		</div>
		<script
			src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.6.11/vue.js"
			integrity="sha512-PyKhbAWS+VlTWXjk/36s5hJmUJBxcGY/1hlxg6woHD/EONP2fawZRKmvHdTGOWPKTqk3CPSUPh7+2boIBklbvw=="
			crossorigin="anonymous"
		></script>
		<script src='https://cdnjs.cloudflare.com/ajax/libs/axios/0.8.1/axios.js' integrity='sha512-yQvhnV+bdDcAhyxTlmVUyNikQCtnIkfC9r7GesIjLg6IrJx2M92DSv58LpyobngV7WUeM1c3mpgP0971pIY98A==' crossorigin='anonymous'></script>
		<script>
			new Vue({
				el: "#app",
				data() {
					return {
						table_head: [
							"會員編號",
                            "會員帳號",
                            "會員密碼",
                            "會員名稱",
                            "會員電話",
                            "會員地址",
                            "累積里程",
                            "會員信用卡",
							"會員照片",
							"會員狀態",
						],
                        itemPic:"",
                        itemPicFD:new FormData(),
                        newItem:{
                                item_ID: "",
								item_Name: "",
								item_PIC: "",
								item_Status: 0,
                        },
						items: [
						],
						visibility: "all",
					};
				},
				computed: {
					filters: function () {
                       if (this.visibility == "all") {
							return this.items;
						} else if (this.visibility == "active") {
							let newData = [];
							this.items.forEach(function (item) {
								if (item.Member_Status == 0) {
									newData.push(item);
								}
							});
							return newData;
						} else if (this.visibility == "completed") {
							let newData = [];
							this.items.forEach(function (item) {
								if (item.Member_Status == 1) {
									newData.push(item);
								}
							});
							return newData;
						}
						return [];
					},
				},
				methods: {
					fetchAllDate:function(){
						axios.post("./php/memberManage.php",{
							action:'fetchall'
						}).then(res=>
							{
							this.items=res.data
						}
						)
					},
                    editData(item){
						axios.post("./php/memberManage.php",{
							action:'update',
							itemId:item.Member_ID,
                            itemAcc:item.Member_Mail,
                            itemPswd:item.Member_PSWD,
							itemName:item.Member_Name,
                            itemPhone:item.Member_Phone,
							itemAdds:item.Member_Address,
                            itemCard:item.Member_Card,
							itemSts:item.Member_Status
						}).then(res=>{
							this.fetchAllDate()
							alert(res.data.message)
						})
					},

					
					deleteData(id){
						if(confirm("確定是否刪除")){
							axios.post('./php/memberManage.php',{
								action:'delete',
								id:id,
							}).then(res=>{
								this.fetchAllDate()
								alert(res.data.message)
							})
						}
					},  
                },
				created() {
					this.fetchAllDate();
				},
                
			});
		</script>
	</body>
</html>
